# ColourBoard
Node.js webpanel for the score data generated by players of ColourChanger (https://colours.aidanof.com).

To get the server up and running using Docker Compose, run the following command:

```
docker-compose up
```

This will start up the server on port 3000. The port can be changed in the `docker-compose.yml` file.

For development, you can use the dev service, which will automatically restart node when any watched file is changed:

```
docker-compose up colour_board_dev
```

for the changes to take effect. If changes affect the Dockerfile (e.g. the required modules, the location of the
file run in the CMD, you can rebuild the image by running

```
docker-compose build
```

To see the logs of a running container:
```
docker logs --tail 100 -f web
```

**Live debugging**

You may find it useful to use the dev version of the docker image, which will allow you to trigger live server changes
automatically by changing any file in the `src` folder:

```
docker-compose build colour_board_dev
docker-compose up colour_board_dev
```


**Deployment**

Currently deployment is manual. The docker image needs to be built and pushed using:

```
docker build -t colour_board_js .
docker tag colour_board_js:latest 364843010988.dkr.ecr.eu-west-1.amazonaws.com/colour_board_js:latest
docker push 364843010988.dkr.ecr.eu-west-1.amazonaws.com/colour_board_js:latest
```

Once this is done, the service needs to be restarted via AWS ECS. This will cause downtime, as for cost reasons there
is no longer a load balancer/dynamic port management on the deployed server.

**Troubleshooting**

On Windows, you may have an issue where, despite the docker-compose.yml file forwarding the port, your docker app
is not accessible from host. This appears to be a recent Docker For Windows limitation, which can be worked around by
installing a prior Docker version:

```
choco install docker-for-windows --version 17.09.1.14687
```
